
<div class="grid-wrapper">
  <div class="form-container">
    <h1 class="main-title">Local Storage</h1>
    <div class="flex-wrapper">
      <label for="tweet">Tweet:</label>
    <form action="#" id="form" class="form">
      <label for="tweet"></label>
      <textarea id="tweet" class="form-textarea"></textarea>
      <input type="submit" class="button button-primary" value="Save Tweet">
    </form>
    </div>
  </div>
  <div class="list-container">
    <h2 class="title">My Tweets</h2>
    <div id="tweet-list">
    </div>
  </div>
</div>

<script>
(function() {

  const tweetBox = document.querySelector('#tweet');
  const form = document.querySelector('#form');
  const tweetListContainer = document.querySelector('#tweet-list');

  function animateTweet( tweet ) {
    TweenMax.set(tweet, {
      autoAlpha: 0,
      y: 200,
      scaleX: 0.1
    });
    TweenMax.to(tweet, .3, {
      autoAlpha: 1,
      y: 0,
      scaleX: 1,
      ease:Back.easeOut
    });
  }

  function animateTweetList( tweetList ) {
    TweenMax.set(tweetList, {autoAlpha: 0, scaleX: 0.1, y: -1000});
    TweenMax.staggerTo(tweetList, .5, {
      autoAlpha: 1,
      scaleX: 1,
      y: 0,
      ease:Back.easeOut
    }, -.2);
  }

  function saveTweet( e ) {
    e.preventDefault();

    let tweetText = tweetBox.value;

    const localStorageContent = JSON.parse(localStorage.getItem("userTweet")) || [];

    if(tweetText !== '') {

      localStorageContent.push(tweetText);

      localStorage.setItem( 'userTweet', JSON.stringify( localStorageContent) );

      const lastSavedTweet = localStorageContent[localStorageContent.length - 1];
      const tweetElem = document.createElement( 'div' );
      const dataAttr = document.createAttribute( 'data-key' );
      dataAttr.value = `${localStorageContent.length - 1}`;
      tweetElem.setAttributeNode( dataAttr );
      tweetElem.classList.add( 'tweet-list-item' );

      const paragraph = document.createElement( 'p' );
      paragraph.textContent = lastSavedTweet;

      tweetElem.appendChild( paragraph );

      const removeBtn = document.createElement( 'button' );
      removeBtn.textContent = 'X';
      removeBtn.classList.add( 'remove-tweet' );

      tweetElem.appendChild( removeBtn );

      tweetListContainer.appendChild( tweetElem );


      animateTweet( tweetElem );

      tweetBox.value = '';
    } else {
      alert('Enter the text of your Tweet');
    }
  }

  function displayTweets( animate = false ) {

    const localStorageContent = JSON.parse( localStorage.getItem( 'userTweet' ) );

    if( localStorageContent !== null ) {
      const tweetList = localStorageContent.map( ( tweet, index ) => `<div data-key="${index}" class="tweet-list-item"><p>${tweet}</p> <button class="remove-tweet">X</button></div>` );

      const tweetListStr = tweetList.join( ' ' );
      tweetListContainer.innerHTML = tweetListStr;


      if( animate ) {
        const tweets = document.querySelectorAll( '.tweet-list-item' );
        animateTweetList( tweets );
      }
    }
  }

  function removeTweet( e ) {


    if ( e.target.className === 'remove-tweet' ) {

      const elemKey = e.target.parentElement.getAttribute('data-key');

      let localStorageContent = JSON.parse( localStorage.getItem( 'userTweet' ) );

      if(localStorageContent.length > 0) {

        localStorageContent.splice( elemKey, 1 );

        localStorage.setItem( 'userTweet', JSON.stringify( localStorageContent ) );

        alert( 'tweet removed' );

        displayTweets();
      }

    } else {
      return;
    }

  }

  form.addEventListener('submit', saveTweet);

  tweetListContainer.addEventListener( 'click', removeTweet, false );


  displayTweets( true );
})()

</script>
